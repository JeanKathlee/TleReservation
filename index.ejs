<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TLE Lab Reservation - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-light bg-light border-bottom mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">TLE Lab Reservation</a>
      <div>
        <a class="btn btn-outline-secondary btn-sm me-2" href="/calendar">Calendar</a>
        <% if(user && user.role === 'admin'){ %>
          <a class="btn btn-outline-primary btn-sm" href="/admin">Admin</a>
        <% } %>
      </div>
    </div>
  </nav>

  <div class="container">
    <h2 class="mb-4">Reservations</h2>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a class="nav-link <%= !activeTab || activeTab === 'lab' ? 'active' : '' %>" href="/?tab=lab">Lab Reservation</a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= activeTab === 'myres' ? 'active' : '' %>" href="/?tab=myres">My Reservations</a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= activeTab === 'equipment' ? 'active' : '' %>" href="/?tab=equipment">Equipment Reservation</a>
      </li>
    </ul>

    <!-- Tab Content -->
    <div>
      <!-- Lab Reservation Form -->
      <% if (!activeTab || activeTab === 'lab') { %>
        <h5>New Lab Reservation</h5>
        <form action="/reserve" method="post" class="mb-4">
          <div class="mb-2">
            <label>Venue</label>
            <select name="venue" class="form-select" required>
              <option>Home Economics Lab</option>
              <option>Sewing Lab</option>
              <option>Accounting Lab</option>
              <option>BPFM Lab</option>
              <option>Housekeeping Lab</option>
              <option>Comp Lab 1</option>
              <option>Comp Lab 2</option>
              <option>Drafting Lab</option>
              <option>EMS/Caregiving</option>
            </select>
          </div>
          <div class="mb-2"><label>Date <input type="date" name="date" class="form-control" required></label></div>
          <div class="mb-2"><label>Time From <input type="time" name="time_from" class="form-control" required></label></div>
          <div class="mb-2"><label>Time To <input type="time" name="time_to" class="form-control" required></label></div>
          <div class="mb-2"><label>Purpose of Activity <input type="text" name="purpose" class="form-control"></label></div>
          <div class="mb-2"><label>Tools, Equipment / Facilities to be used <input type="text" name="equipment" class="form-control"></label></div>
          <div class="mb-2"><label>Person making the reservation <input type="text" name="person_name" class="form-control" value="<%= user ? user.username : '' %>" required></label></div>
          <button class="btn btn-primary mt-2" type="submit">Submit Reservation</button>
        </form>
      <% } %>

      <!-- My Reservations -->
      <% if (activeTab === 'myres') { %>
        <h5>My Reservations</h5>
        <% if (mine.length === 0) { %>
          <p>No reservations yet.</p>
        <% } else { %>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Venue / Equipment</th>
                <th>Date</th>
                <th>Time</th>
                <th>Purpose</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% mine.forEach(r => { %>
                <tr>
                  <td><%= r.id %></td>
                  <td><%= r.venue === 'Equipment' ? r.equipment : r.venue %></td>
                  <td><%= r.date %></td>
                  <td><%= r.time_from %> - <%= r.time_to %></td>
                  <td><%= r.purpose %></td>
                  <td><%= r.status %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      <% } %>

      <!-- Equipment Reservation Form -->
      <% if (activeTab === 'equipment') { %>
        <h5>New Equipment Reservation</h5>
        <form action="/reserve" method="POST" class="mb-4">
          <div class="mb-2">
            <label>Equipment Name</label>
            <input type="text" name="equipment" class="form-control" required>
          </div>
          <div class="mb-2"><label>Date <input type="date" name="date" class="form-control" required></label></div>
          <div class="mb-2"><label>Time From <input type="time" name="time_from" class="form-control" required></label></div>
          <div class="mb-2"><label>Time To <input type="time" name="time_to" class="form-control" required></label></div>
          <div class="mb-2"><label>Purpose <input type="text" name="purpose" class="form-control" required></label></div>
          <div class="mb-2"><label>Person making the reservation <input type="text" name="person_name" class="form-control" value="<%= user ? user.username : '' %>" required></label></div>
          <button class="btn btn-success mt-2" type="submit">Submit Equipment Reservation</button>
        </form>
      <% } %>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
